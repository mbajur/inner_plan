<div class="d-flex w-100 mb-1" data-id="<%= task.id %>" data-update-url="<%= update_position_task_path(task) %>">
  <div class="align-top me-2 text-body-tertiary task-handle cm <%= 'invisible' if task.completed? %>" style="margin-top:-0.06rem">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="20" height="20" stroke-width="2">
      <path d="M9 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
      <path d="M9 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
      <path d="M9 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
      <path d="M15 5m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
      <path d="M15 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
      <path d="M15 19m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
    </svg>
  </div>

  <div class="align-top" style="width:2rem; height: 2rem; margin-top: -0.15rem">
    <% if task.ongoing? %>
      <%= button_to complete_task_path(task), method: :post, class: 'btn p-0', form: { data: { turbo: true, turbo_stream: true } } do %>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="24" height="24" stroke-width="2">
          <path d="M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z"></path>
        </svg>
      <% end %>
    <% else %>
      <%= button_to reopen_task_path(task), method: :post, class: 'btn p-0 text-success opacity-75' do %>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="24" height="24" stroke-width="2">
          <path d="M3 3m0 2a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v14a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2z"></path>
          <path d="M9 12l2 2l4 -4"></path>
        </svg>
      <% end %>
    <% end %>
  </div>

  <div class="<%= class_names('form-check-label ms-1 w-100', 'text-body-tertiary' => task.completed?) %>">
    <%= link_to task.title, task, class: 'text-reset text-decoration-none' %>

    <% if task.completed? && !task.group.default? %>
      &mdash; <%= task.group.title %>
    <% else %>
      <% if task.description.present? %>
        <span class="text-body-tertiary">
          <svg style="margin-top: -0.1rem" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="15" height="15" stroke-width="2">
            <path d="M14 3v4a1 1 0 0 0 1 1h4"></path>
            <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z"></path>
            <path d="M9 9l1 0"></path>
            <path d="M9 13l6 0"></path>
            <path d="M9 17l6 0"></path>
          </svg>
        </span>
      <% end %>

      <% if task.due_on.present? %>
        <small class="text-body-tertiary text-nowrap">
          <svg style="margin-top: -0.2rem"  xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" width="15" height="15" stroke-width="2">
            <path d="M4 5m0 2a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-12a2 2 0 0 1 -2 -2z"></path>
            <path d="M16 3v4"></path>
            <path d="M8 3v4"></path>
            <path d="M4 11h16"></path>
            <path d="M12 16m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"></path>
          </svg>

          <%= task.due_on.strftime('%a, %b %e') %>
        </small>
      <% end %>

      <% if task.assigned_user_ids.any? %>
        <% task.assigned_users.map do |user| %>
          <small class="text-nowrap opacity-50 ms-1">
            <%= image_tag user.profile.avatar_url, size: 20, class: 'rounded-circle', style: 'margin-top:-0.2rem' %>
            <%= user.profile.to_s %>
          </small>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>
